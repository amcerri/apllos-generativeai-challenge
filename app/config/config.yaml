# ----------------------------------------------------------------------------
# Base configuration
# Notes
#   - Keep values conservative; environment variables may override at runtime.
#   - Booleans are lowercase (YAML spec).
#   - This file is read by lightweight helpers and higher-level loaders later.
# ----------------------------------------------------------------------------

app:
  env: development  # development | staging | production

server:
  host: 0.0.0.0
  port: 2024           # LangGraph Server port
  studio_port: 2025    # LangGraph Studio port (if applicable)

openai:
  router_model: gpt-4o-mini
  analytics_planner_model: gpt-4o-mini
  analytics_planner_fallback: gpt-4o-mini
  knowledge_model: gpt-4o-mini
  knowledge_model_mini: gpt-4o-mini
  commerce_model: gpt-4o-mini
  embeddings_model: text-embedding-3-small
  request_timeout_ms: 30000
  max_retries: 3

routing:
  confidence_min: 0.55      # Minimum confidence from router for a primary route
  fallback_enabled: true    # Allow a single analytics<->knowledge fallback

analytics:
  planner:
    default_limit: 200      # Applied to non-aggregated queries
    max_limit: 1000
    disallow_select_star: true
    require_limit_on_non_aggregate: true
  sql:
    readonly: true
    max_rows: 5000
    timeout_ms: 15000
    # Optional path for the allowlist snapshot generated by scripts/gen_allowlist.py
    allowlist_path: app/routing/allowlist.json
  executor:
    explain_analyze: false  # Enable only in staging if needed

knowledge:
  retrieval:
    top_k: 8
    min_score: 0.18         # Below this -> no_context=true
    deduplicate: true
    index: docs             # pgvector collection/table name
  ranker:
    rerank_top_k: 6
  answerer:
    max_tokens: 800
    require_citations: true

commerce:
  extraction:
    min_confidence: 0.50
  validation:
    line_total_tolerance: 0.02   # Accept Â±2% difference between sum(lines) and subtotal
    currency_default: BRL
  summarizer:
    max_tokens: 600

observability:
  logging:
    level: INFO
    structlog_json: false
  tracing:
    enabled: false
    sample_ratio: 0.0

database:
  url: postgresql+psycopg://app:app@localhost:5432/app
  pool_size: 10
  pool_timeout_sec: 10

checkpointer:
  enabled: true
  backend: postgres
  table: checkpoints

interruptions:
  require_approval_for:
    - analytics.execute_sql
    - commerce.external_call
